/*! For license information please see main.js.LICENSE.txt */
(()=>{var t={775:(t,e,o)=>{"use strict";o.r(e)},499:function(t,e,o){var s,n;!function(i,r){"use strict";void 0===(n="function"==typeof(s=function(){var t={};function e(t,e){this.x=t||0,this.y=e||0}function o(t,o){this.pos=t||new e,this.r=o||0,this.offset=new e}function s(t,o){this.pos=t||new e,this.angle=0,this.offset=new e,this.setPoints(o||[])}function n(t,o,s){this.pos=t||new e,this.w=o||0,this.h=s||0}function i(){this.a=null,this.b=null,this.overlapN=new e,this.overlapV=new e,this.clear()}t.Vector=e,t.V=e,e.prototype.copy=e.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this},e.prototype.clone=e.prototype.clone=function(){return new e(this.x,this.y)},e.prototype.perp=e.prototype.perp=function(){var t=this.x;return this.x=this.y,this.y=-t,this},e.prototype.rotate=e.prototype.rotate=function(t){var e=this.x,o=this.y;return this.x=e*Math.cos(t)-o*Math.sin(t),this.y=e*Math.sin(t)+o*Math.cos(t),this},e.prototype.reverse=e.prototype.reverse=function(){return this.x=-this.x,this.y=-this.y,this},e.prototype.normalize=e.prototype.normalize=function(){var t=this.len();return t>0&&(this.x=this.x/t,this.y=this.y/t),this},e.prototype.add=e.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},e.prototype.sub=e.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this},e.prototype.scale=e.prototype.scale=function(t,e){return this.x*=t,this.y*=void 0!==e?e:t,this},e.prototype.project=e.prototype.project=function(t){var e=this.dot(t)/t.len2();return this.x=e*t.x,this.y=e*t.y,this},e.prototype.projectN=e.prototype.projectN=function(t){var e=this.dot(t);return this.x=e*t.x,this.y=e*t.y,this},e.prototype.reflect=e.prototype.reflect=function(t){var e=this.x,o=this.y;return this.project(t).scale(2),this.x-=e,this.y-=o,this},e.prototype.reflectN=e.prototype.reflectN=function(t){var e=this.x,o=this.y;return this.projectN(t).scale(2),this.x-=e,this.y-=o,this},e.prototype.dot=e.prototype.dot=function(t){return this.x*t.x+this.y*t.y},e.prototype.len2=e.prototype.len2=function(){return this.dot(this)},e.prototype.len=e.prototype.len=function(){return Math.sqrt(this.len2())},t.Circle=o,o.prototype.getAABBAsBox=o.prototype.getAABBAsBox=function(){var t=this.r;return new n(this.pos.clone().add(this.offset).sub(new e(t,t)),2*t,2*t)},o.prototype.getAABB=o.prototype.getAABB=function(){return this.getAABBAsBox().toPolygon()},o.prototype.setOffset=o.prototype.setOffset=function(t){return this.offset=t,this},t.Polygon=s,s.prototype.setPoints=s.prototype.setPoints=function(t){if(!this.points||this.points.length!==t.length){var o,s=this.calcPoints=[],n=this.edges=[],i=this.normals=[];for(o=0;o<t.length;o++){var r=t[o],a=o<t.length-1?t[o+1]:t[0];r===a||r.x!==a.x||r.y!==a.y?(s.push(new e),n.push(new e),i.push(new e)):(t.splice(o,1),o-=1)}}return this.points=t,this._recalc(),this},s.prototype.setAngle=s.prototype.setAngle=function(t){return this.angle=t,this._recalc(),this},s.prototype.setOffset=s.prototype.setOffset=function(t){return this.offset=t,this._recalc(),this},s.prototype.rotate=s.prototype.rotate=function(t){for(var e=this.points,o=e.length,s=0;s<o;s++)e[s].rotate(t);return this._recalc(),this},s.prototype.translate=s.prototype.translate=function(t,e){for(var o=this.points,s=o.length,n=0;n<s;n++)o[n].x+=t,o[n].y+=e;return this._recalc(),this},s.prototype._recalc=function(){var t,e=this.calcPoints,o=this.edges,s=this.normals,n=this.points,i=this.offset,r=this.angle,a=n.length;for(t=0;t<a;t++){var c=e[t].copy(n[t]);c.x+=i.x,c.y+=i.y,0!==r&&c.rotate(r)}for(t=0;t<a;t++){var h=e[t],p=t<a-1?e[t+1]:e[0],u=o[t].copy(p).sub(h);s[t].copy(u).perp().normalize()}return this},s.prototype.getAABBAsBox=s.prototype.getAABBAsBox=function(){for(var t=this.calcPoints,o=t.length,s=t[0].x,i=t[0].y,r=t[0].x,a=t[0].y,c=1;c<o;c++){var h=t[c];h.x<s?s=h.x:h.x>r&&(r=h.x),h.y<i?i=h.y:h.y>a&&(a=h.y)}return new n(this.pos.clone().add(new e(s,i)),r-s,a-i)},s.prototype.getAABB=s.prototype.getAABB=function(){return this.getAABBAsBox().toPolygon()},s.prototype.getCentroid=s.prototype.getCentroid=function(){for(var t=this.calcPoints,o=t.length,s=0,n=0,i=0,r=0;r<o;r++){var a=t[r],c=r===o-1?t[0]:t[r+1],h=a.x*c.y-c.x*a.y;s+=(a.x+c.x)*h,n+=(a.y+c.y)*h,i+=h}return new e(s/=i*=3,n/=i)},t.Box=n,n.prototype.toPolygon=n.prototype.toPolygon=function(){var t=this.pos,o=this.w,n=this.h;return new s(new e(t.x,t.y),[new e,new e(o,0),new e(o,n),new e(0,n)])},t.Response=i,i.prototype.clear=i.prototype.clear=function(){return this.aInB=!0,this.bInA=!0,this.overlap=Number.MAX_VALUE,this};for(var r=[],a=0;a<10;a++)r.push(new e);var c=[];for(a=0;a<5;a++)c.push([]);var h=new i,p=new n(new e,1e-6,1e-6).toPolygon();function u(t,e,o){for(var s=Number.MAX_VALUE,n=-Number.MAX_VALUE,i=t.length,r=0;r<i;r++){var a=t[r].dot(e);a<s&&(s=a),a>n&&(n=a)}o[0]=s,o[1]=n}function l(t,e,o,s,n,i){var a=c.pop(),h=c.pop(),p=r.pop().copy(e).sub(t),l=p.dot(n);if(u(o,n,a),u(s,n,h),h[0]+=l,h[1]+=l,a[0]>h[1]||h[0]>a[1])return r.push(p),c.push(a),c.push(h),!0;if(i){var y,d,f=0;a[0]<h[0]?(i.aInB=!1,a[1]<h[1]?(f=a[1]-h[0],i.bInA=!1):f=(y=a[1]-h[0])<(d=h[1]-a[0])?y:-d):(i.bInA=!1,a[1]>h[1]?(f=a[0]-h[1],i.aInB=!1):f=(y=a[1]-h[0])<(d=h[1]-a[0])?y:-d);var _=Math.abs(f);_<i.overlap&&(i.overlap=_,i.overlapN.copy(n),f<0&&i.overlapN.reverse())}return r.push(p),c.push(a),c.push(h),!1}function y(t,e){var o=t.len2(),s=e.dot(t);return s<0?d:s>o?_:f}t.isSeparatingAxis=l;var d=-1,f=0,_=1;function g(t,e,o){for(var s=r.pop().copy(e.pos).add(e.offset).sub(t.pos),n=e.r,i=n*n,a=t.calcPoints,c=a.length,h=r.pop(),p=r.pop(),u=0;u<c;u++){var l=u===c-1?0:u+1,f=0===u?c-1:u-1,g=0,b=null;h.copy(t.edges[u]),p.copy(s).sub(a[u]),o&&p.len2()>i&&(o.aInB=!1);var m=y(h,p);if(m===d){h.copy(t.edges[f]);var v=r.pop().copy(s).sub(a[f]);if((m=y(h,v))===_){if((O=p.len())>n)return r.push(s),r.push(h),r.push(p),r.push(v),!1;o&&(o.bInA=!1,b=p.normalize(),g=n-O)}r.push(v)}else if(m===_){if(h.copy(t.edges[l]),p.copy(s).sub(a[l]),(m=y(h,p))===d){if((O=p.len())>n)return r.push(s),r.push(h),r.push(p),!1;o&&(o.bInA=!1,b=p.normalize(),g=n-O)}}else{var x=h.perp().normalize(),O=p.dot(x),M=Math.abs(O);if(O>0&&M>n)return r.push(s),r.push(x),r.push(p),!1;o&&(b=x,g=n-O,(O>=0||g<2*n)&&(o.bInA=!1))}b&&o&&Math.abs(g)<Math.abs(o.overlap)&&(o.overlap=g,o.overlapN.copy(b))}return o&&(o.a=t,o.b=e,o.overlapV.copy(o.overlapN).scale(o.overlap)),r.push(s),r.push(h),r.push(p),!0}function b(t,e,o){for(var s=t.calcPoints,n=s.length,i=e.calcPoints,r=i.length,a=0;a<n;a++)if(l(t.pos,e.pos,s,i,t.normals[a],o))return!1;for(a=0;a<r;a++)if(l(t.pos,e.pos,s,i,e.normals[a],o))return!1;return o&&(o.a=t,o.b=e,o.overlapV.copy(o.overlapN).scale(o.overlap)),!0}return t.pointInCircle=function(t,e){var o=r.pop().copy(t).sub(e.pos).sub(e.offset),s=e.r*e.r,n=o.len2();return r.push(o),n<=s},t.pointInPolygon=function(t,e){p.pos.copy(t),h.clear();var o=b(p,e,h);return o&&(o=h.aInB),o},t.testCircleCircle=function(t,e,o){var s=r.pop().copy(e.pos).add(e.offset).sub(t.pos).sub(t.offset),n=t.r+e.r,i=n*n,a=s.len2();if(a>i)return r.push(s),!1;if(o){var c=Math.sqrt(a);o.a=t,o.b=e,o.overlap=n-c,o.overlapN.copy(s.normalize()),o.overlapV.copy(s).scale(o.overlap),o.aInB=t.r<=e.r&&c<=e.r-t.r,o.bInA=e.r<=t.r&&c<=t.r-e.r}return r.push(s),!0},t.testPolygonCircle=g,t.testCirclePolygon=function(t,e,o){var s=g(e,t,o);if(s&&o){var n=o.a,i=o.aInB;o.overlapN.reverse(),o.overlapV.reverse(),o.a=o.b,o.b=n,o.aInB=o.bInA,o.bInA=i}return s},t.testPolygonPolygon=b,t})?s.call(e,o,e,t):s)||(t.exports=n)}()},278:function(t,e,o){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=s(o(843)),i=s(o(993)),r=s(o(931)),a=s(o(800)),c=s(o(698)),h=s(o(895)),p=s(o(230)),u=s(o(799)),l=s(o(708)),y=s(o(411)),d=s(o(402)),f=s(o(737));e.default=class{constructor(t){const{rootSelector:e,height:o,width:s}=t,h=document.querySelector(e),p=h.getContext("2d");this._height=o,this._width=s,h.height=this._height,h.width=this._width,this._tickManager=new a.default,this._inputManager=new i.default(this._tickManager),this._gameObjectsManager=new r.default,this._physicsManager=new c.default(this._gameObjectsManager),this._renderManager=new n.default({context:p,gameObjectManager:this._gameObjectsManager}),this._tickManager.onUpdate((({deltaTime:t})=>this._onTick(t)))}start(){this._addPlayer(),this._initControls(),this._addObstacle({x:300,y:300}).getComponent("rigibody").push(5,5),this._addObstacle({x:400,y:300}).getComponent("rigibody").push(2,-5),this._addObstacle({x:500,y:300}).getComponent("rigibody").push(-5,20),this._addObstacle({x:600,y:300}).getComponent("rigibody").push(22,-1),this._addObstacle({x:700,y:300}).getComponent("rigibody").push(-.5,15),this._addObstacle({x:800,y:300}).getComponent("rigibody").push(35,-.5),this._addObstacle({x:900,y:300}).getComponent("rigibody").push(5,5),this._addObstacle({x:1e3,y:300}).getComponent("rigibody").push(5,5),this._addObstacle({x:1100,y:300}).getComponent("rigibody").push(5,5),this._addObstacle({x:1200,y:300}).getComponent("rigibody").push(5,5),this._addObstacle({x:100,y:300}).getComponent("rigibody").turn(250),this._tickManager.start()}freeze(){this._tickManager.freeze()}_addPlayer(){const t=new y.default({points:[{x:-10,y:-10},{x:10,y:-10},{x:10,y:10},{x:-10,y:10}]}),e=new u.default({shape:t}),o=new p.default({shape:t}),s=new l.default({}),n=new h.default({maxHealth:10,rotation:0,position:{x:300,y:300}});n.setComponent(e),n.setComponent(o),n.setComponent(s),this._player=n,this._gameObjectsManager.instantiate(n)}_addObstacle(t){const e=new y.default({points:[{x:-40,y:-40},{x:40,y:-40},{x:40,y:40},{x:-40,y:40}]}),o=new u.default({shape:e}),s=new p.default({shape:e}),n=new l.default({}),i=new f.default({position:t,rotation:0});return i.setComponent(s),i.setComponent(o),i.setComponent(n),this._gameObjectsManager.instantiate(i),i}_initControls(){const t=this._player.getComponent("rigibody");this._inputManager.setListener({keyCode:"KeyW",onDown:()=>{const e=Math.cos((0,d.default)(this._player.rotation+t.rotationVelocity))/8,o=Math.sin((0,d.default)(this._player.rotation+t.rotationVelocity))/8;t.push(e,o)}}),this._inputManager.setListener({keyCode:"KeyD",onDown:()=>{t.turn(.1)}}),this._inputManager.setListener({keyCode:"KeyA",onDown:()=>{t.turn(-.1)}}),this._inputManager.setListener({keyCode:"Space",onDown:()=>{this._player.shoot()},once:!0})}_onTick(t){const{gameObjects:e}=this._gameObjectsManager;e.forEach((t=>{const o=t.getComponent("collider");e.forEach((t=>{o.collidesWith(t.getComponent("collider"))}))})),this._physicsManager.move(t),this._renderManager.rerender()}}},737:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor({position:t,rotation:e}){this.position={x:0,y:0},this.rotation=0,this._components={},t&&(this.position=t),e&&(this.rotation=e)}setComponent(t){this._components[t.name]=t,t.setGameObject(this)}getComponent(t){return this._components[t]}}},854:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor({gameObject:t}){t&&(this._gameObject=t)}setGameObject(t){this._gameObject=t}}},411:function(t,e,o){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=s(o(402));e.default=class{constructor({points:t}){this.points=t}getPointsPosition(t,e){return this.points.map((o=>{const{x:s,y:n}=o,{x:i,y:r}=t;return this._rotatePoint(s+i,n+r,e,t)}))}_rotatePoint(t,e,o,s){const i=(0,n.default)(o),r=Math.cos(i),a=Math.sin(i),{x:c,y:h}=s;return{x:c+(t-c)*r-(e-h)*a,y:h+(t-c)*a+(e-h)*r}}}},335:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(t=0,e=0){this.x=t,this.y=e}static zero(){return{x:0,y:0}}}},799:function(t,e,o){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=s(o(499)),i=s(o(335)),r=s(o(854));class a extends r.default{constructor(t){super(t),this.collisionCallbacks=[],this.name="collider",this.shape=t.shape}collidesWith(t){if(!this._gameObject||t==this)return!1;const e=this._turnShapeIntoSATPolygon(this.shape,this._gameObject.position,this._gameObject.rotation),o=this._turnShapeIntoSATPolygon(t.shape,t._gameObject.position,t._gameObject.rotation);n.default.testPolygonPolygon(e,o)&&console.log("Collision!",this._gameObject),this.collisionCallbacks.forEach((t=>t()))}onCollision(t){this.collisionCallbacks.push(t)}_turnShapeIntoSATPolygon(t,e,o){const s=t.getPointsPosition(i.default.zero(),o).map((t=>{const{x:e,y:o}=t;return new n.default.Vector(e,o)}));return new n.default.Polygon(new n.default.Vector(e.x,e.y),s)}}e.default=a},230:function(t,e,o){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=s(o(854));class i extends n.default{constructor(t){super(t),this.name="mesh",t.shape&&(this.shape=t.shape),this._gameObject=t.gameObject}draw({context:t}){if(!this.shape)return;t.beginPath();const{position:e,rotation:o}=this._gameObject;this.shape.getPointsPosition(e,o).forEach((e=>{const{x:o,y:s}=e;t.lineTo(o,s)})),t.closePath(),t.stroke(),t.fill()}}e.default=i},708:function(t,e,o){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=s(o(854));class i extends n.default{constructor(t){super(t),this.velocity={x:0,y:0},this.friction=.02,this.rotationVelocity=0,this.rotationFriction=.02,this.name="rigibody"}move(t){this._gameObject&&(this._moveGameObject(t),this._rotateGameObject(t))}push(t,e){this.velocity.x+=t,this.velocity.y+=e}turn(t){this.rotationVelocity+=t}_moveGameObject(t){this._gameObject.position.x+=this.velocity.x*t,this._gameObject.position.y+=this.velocity.y*t,this.velocity.x*=1-this.friction,this.velocity.y*=1-this.friction}_rotateGameObject(t){this._gameObject.rotation+=this.rotationVelocity*t,this.rotationVelocity*=1-this.rotationFriction}}e.default=i},931:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(){this.gameObjects=[]}instantiate(t){this.gameObjects.push(t)}}},993:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(t){this.tickManager=t}setListener(t){const{keyCode:e,onDown:o,onUp:s,once:n}=t,i=this.tickManager;let r;function a(t){t.repeat||t.code===e&&(o&&!n?r=i.onUpdate(o):o())}function c(t){t.code===e&&(o&&!n&&r(),s&&s())}return document.addEventListener("keydown",a),document.addEventListener("keyup",c),()=>{document.removeEventListener("keydown",a),document.removeEventListener("keyup",c)}}}},698:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(t){this._gameObjectsManager=t}move(t){this._gameObjectsManager.gameObjects.forEach((e=>{const o=e.getComponent("rigibody");o&&o.move(t)}))}}},843:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor({gameObjectManager:t,context:e,backgroundColor:o,entitiesColor:s}){this._gameObjectService=t,this._context=e,this._backgroundColor=o||"#1B2430",this._entitiesColor=s||"white"}rerender(){this._clearCanvas(),this._gameObjectService.gameObjects.forEach((t=>{const e=t.getComponent("mesh");e&&e.draw({context:this._context})}))}_clearCanvas(){this._context.fillStyle=this._backgroundColor,this._context.fillRect(0,0,innerWidth,innerHeight),this._context.fillStyle=this._entitiesColor}}},800:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(){this.updateCallbacks=new Set,this.perfectFramerate=60,this.deltaTime=0,this.lastTimestamp=0}onUpdate(t){return this.updateCallbacks.add(t),()=>{this.updateCallbacks.delete(t)}}start(){this.stopped=!1,this.tickRequestId=requestAnimationFrame((t=>this._update(t)))}freeze(){cancelAnimationFrame(this.tickRequestId)}_update(t){this.updateCallbacks.forEach((t=>t(this._getUpdateCallbackContext()))),this.tickRequestId=requestAnimationFrame((t=>this._update(t))),this.deltaTime=(t-this.lastTimestamp)/(1e3/this.perfectFramerate),this.lastTimestamp=t}_getUpdateCallbackContext(){return{deltaTime:this.deltaTime}}}},402:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return t*Math.PI/180}},263:function(t,e,o){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=s(o(737));class i extends n.default{constructor({position:t,rotation:e,maxHealth:o,health:s}){super({position:t,rotation:e}),this.maxHealth=o,this.health=s||o}}e.default=i},895:function(t,e,o){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=s(o(263));class i extends n.default{constructor(t){super(t)}shoot(){console.log("shooting")}}e.default=i},156:function(t,e,o){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),o(775),new(s(o(278)).default)({rootSelector:"#root",width:window.innerWidth,height:window.innerHeight}).start()}},e={};function o(s){var n=e[s];if(void 0!==n)return n.exports;var i=e[s]={exports:{}};return t[s].call(i.exports,i,i.exports,o),i.exports}o.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o(156)})();